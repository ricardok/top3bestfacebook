function User(t,e){this.id=t,this.name=e,this.points=0,this.tagged=!1,this.invited=!1}function calculate_tagged_users(t,e){FB.api("me/photos?fields=tags{name,id}&type=uploaded",function(a){if(a&&!a.error)for(var n=0;n<a.data.length;n++)if(a.data[n].hasOwnProperty("tags"))for(var i=0;i<a.data[n].tags.data.length;i++){var s=$.grep(t,function(t){return t.id==a.data[n].tags.data[i].id});if(0==s.length){if(a.data[n].tags.data[i].id!==uid){var o=new User(a.data[n].tags.data[i].id,a.data[n].tags.data[i].name);o.addPoints(5),o.changeToTagged(),t.push(o)}}else 1==s.length&&0==s[0].tagged&&s[0].addPoints(5)}e()})}function calculate_likes_users(t,e){FB.api("me?fields=posts.limit(20){likes{name,id}}",function(a){if(a&&!a.error)for(var n=0;n<a.posts.data.length;n++)if(a.posts.data[n].hasOwnProperty("likes"))for(var i=0;i<a.posts.data[n].likes.data.length;i++){var s=$.grep(t,function(t){return t.id==a.posts.data[n].likes.data[i].id});if(0==s.length){if(a.posts.data[n].likes.data[i].id!==uid){var o=new User(a.posts.data[n].likes.data[i].id,a.posts.data[n].likes.data[i].name);o.addPoints(1),t.push(o)}}else 1==s.length&&s[0].addPoints(1)}e()})}function calculate_comments_users(t,e){FB.api("me?fields=posts.limit(20){likes{name,id}}",function(a){if(a&&!a.error)for(var n=0;n<a.posts.data.length;n++)if(a.posts.data[n].hasOwnProperty("comments"))for(var i=0;i<a.posts.data[n].comments.data.length;i++){var s=$.grep(t,function(t){return t.id==a.posts.data[n].comments.data[i].from.id});if(0==s.length){if(a.posts.data[n].comments.data[i].from.id!==uid){var o=new User(a.posts.data[n].comments.data[i].from.id,a.posts.data[n].comments.data[i].from.name);o.addPoints(1),t.push(o)}}else 1==s.length&&s[0].addPoints(1)}e()})}function calculate_paging_events(t,e,a){FB.api(e,function(e){if(e&&!e.error){for(var n=0;n<e.data.length;n++){var i=$.grep(t,function(t){return t.id==e.data[n].owner.id});if(0==i.length&&"attending"==e.data[n].rsvp_status){if(e.data[n].owner.id!==e.data[n].owner.id){var s=new User(e.data[n].owner.id,e.data[n].owner.name);s.addPoints(5),s.changeToInvited(),t.push(s)}}else 1==i.length&&"attending"==e.data[n].rsvp_status&&0==i[0].invited&&i[0].addPoints(5)}e.hasOwnProperty("paging")?e.paging.hasOwnProperty("next")&&calculate_paging_events(t,e.paging.next,a):a()}})}function calculate_events_users(t,e){FB.api("me?fields=events{rsvp_status,owner,type}",function(a){if(a&&!a.error){for(var n=0;n<a.events.data.length;n++){var i=$.grep(t,function(t){return t.id==a.events.data[n].owner.id});if(0==i.length&&"attending"==a.events.data[n].rsvp_status){if(a.events.data[n].owner.id!==uid){var s=new User(a.events.data[n].owner.id,a.events.data[n].owner.name);s.addPoints(5),s.changeToInvited(),t.push(s)}}else 1==i.length&&"attending"==a.events.data[n].rsvp_status&&0==i[0].invited&&i[0].addPoints(5)}a.events.paging.hasOwnProperty("next")&&calculate_paging_events(t,a.events.paging.next,function(){e()})}})}function set_user_picture(t,e){FB.api(e+"/picture?type=large",function(e){t.find("img").attr("src",e.data.url)})}function get_best_friends(){$(".bestfriends-container").append('<div id="loading_friends-img"><img src="images/loading_friends.gif" alt="loading"></div>');var t=[];calculate_tagged_users(t,function(){calculate_likes_users(t,function(){calculate_comments_users(t,function(){calculate_events_users(t,function(){t.sort(function(t,e){return parseFloat(e.points)-parseFloat(t.points)}),$(".image-profile").each(function(e){set_user_picture($(this),t[e].id),$(this).find("p").html((e+1).toString()+": "+t[e].name)}),$("#results").show(),$("#loading_friends-img").remove()})})})})}function change_panelTitle(){$(".panel-heading .title").html("Login using Facebook")}function toggle_elements(){$("#loginButton").toggle(),$("#logout_btn").toggle(),$("#getFriends").toggle(),$(".panel-heading").toggleClass("panel-heading-logged-view"),$(".panel-heading p").toggle(),$(".panel-heading .title").html("Who are my best friends app!")}function change_UIview(t){1===t?$(".panel").slideToggle("slow",function(){toggle_elements(),$("#results").hide()}).delay(500).slideToggle("slow"):0===t&&toggle_elements()}function fb_logout(){FB.logout(function(){change_UIview(1),change_panelTitle()})}function check_login_status(){FB.getLoginStatus(function(t){"connected"===t.status?(change_UIview(0),uid=t.authResponse.userID,console.log(uid)):"not_authorized"===t.status&&change_panelTitle()})}function fb_login(){FB.login(function(t){t.authResponse?(console.log("Welcome!  Fetching your information.... "),uid=t.authResponse.userID,change_UIview(1)):console.log("User cancelled login or did not fully authorize.")},{scope:"publish_actions,user_posts,user_photos,user_events,user_tagged_places"})}var uid;User.prototype.addPoints=function(t){this.points+=t},User.prototype.changeToTagged=function(){this.tagged=!0},User.prototype.changeToInvited=function(){this.invited=!0};