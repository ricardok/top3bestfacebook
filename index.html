<html lang="en-US"><head>
		<meta charset="utf-8">
		<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
		<title>SAPapp - Who's my best Facebook friends ?</title>
		
		<!-- Google font for SEO purposes as well -->
		<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Gafata">
		
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="css/bootstrap.css"> 
		
		<!-- CSS style -->
		<link rel="stylesheet" href="css/style.css"> 

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		

		
		
	</head>
	
	<body>


	<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '468115333349990',
      oauth   : true,
      status  : true, // check login status
      cookie  : true, // enable cookies to allow the server to access the session
      xfbml      : true,
      version    : 'v2.4'
    });
  };

/* --------- User Class --------- */


function User(id, name){
	this.id = id;
	this.name = name;
	this.points = 0;
	this.tagged = 0;
	this.invited = 0;
}

User.prototype.addPoints = function(points){
	this.points += points;
}

User.prototype.changeToTagged = function(){
	this.tagged = 1;
}

/* --------- User Class --------- */

/*
function calculate_tagged_users(users_list){

	FB.api('me/photos?fields=tags{name,id}&type=uploaded',function(response) {
				for(var i = 0; i< response.data.length; i++){
					if(response.data[i].hasOwnProperty('tags')){

						for(var j = 0; j< response.data[i].tags.data.length; j++){

						var user_found = $.grep(users_list, function(e){
						return e.id == response.data[i].tags.data[j].id;
						});

						if(user_found.length == 0){

						var fb_user = new User(response.data[i].tags.data[j].id,response.data[i].tags.data[j].name); // create new user
						fb_user.addPoints(5); // add points to user
						fb_user.changeToTagged(); // Mark user as tagged so we dont add points to him
						users_list.push(fb_user);

						}
						else if(user_found.length == 1){

							if(user_found[0].tagged == 0){
							user_found[0].addPoints(5); // add points to existing user
							}

						}

						}

					}
				}           
            });

}
*/

Array.prototype.clone = function() {
	return this.slice(0);
};

function facebook_user_photos(callback){  
        FB.api('me/photos?fields=tags{name,id}&type=uploaded',function(response) {
                callback(response);
            });
}



function calculate_tagged_users(users_list) {

    var fbPhotos = facebook_user_photos(function(response){

        for(var i = 0; i< response.data.length; i++){
					if(response.data[i].hasOwnProperty('tags')){

						for(var j = 0; j< response.data[i].tags.data.length; j++){

						var user_found = $.grep(users_list, function(e){
						return e.id == response.data[i].tags.data[j].id;
						});

						if(user_found.length == 0){

						var fb_user = new User(response.data[i].tags.data[j].id,response.data[i].tags.data[j].name); // create new user
						fb_user.addPoints(5); // add points to user
						fb_user.changeToTagged(); // Mark user as tagged so we dont add points to him
						users_list.push(fb_user);

						}
						else if(user_found.length == 1){

							if(user_found[0].tagged == 0){
							user_found[0].addPoints(5); // add points to existing user
							}

						}

						}

					}
				}

			var clone_u = users_list.clone();
			return clone_u;

    });

};


function get_best_friends(){
	// a function in which calls to another functions will be made in order to calculate points
	var users_list = [];
	var fb_user = new User('123','Jawad');
	users_list.push(fb_user);

	users_list = calculate_tagged_users(users_list);
	console.log("second: "+users_list);

}





function change_panelTitle(){
$('.panel-heading .title').html('Login using Facebook');
}


function toggle_elements(){
	$('#loginButton').toggle();
	$('#logout_btn').toggle();
	$('#getFriends').toggle();
	$('.panel-heading').toggleClass('panel-heading-logged-view');
	$('.panel-heading p').toggle();
	$('.panel-heading .title').html('Who are my best freinds app!');
}


function change_UIview(useToggle){

	if(useToggle === 1){
	$('.panel').slideToggle('slow',function(){

	toggle_elements();

	}).delay(500).slideToggle('slow');
	}

	else if(useToggle === 0){
	toggle_elements();
	}
}


function fb_logout(){
	FB.logout(function(response) {

    change_UIview(1);
    change_panelTitle();
});
}




function check_login_status(){
				FB.getLoginStatus(function(response) {
  if (response.status === 'connected') {
    // the user is logged in and has authenticated your
    // app, and response.authResponse supplies
    // the user's ID, a valid access token, a signed
    // request, and the time the access token 
    // and signed request each expire
    change_UIview(0);

    var uid = response.authResponse.userID;
    var accessToken = response.authResponse.accessToken;

  } else if (response.status === 'not_authorized') {
  		change_panelTitle();
    // the user is logged in to Facebook, 
    // but has not authenticated your app
  } else {
    // the user isn't logged in to Facebook.
  }
 });
}

  function fb_login(){
    FB.login(function(response) {

        if (response.authResponse) {
            console.log('Welcome!  Fetching your information.... ');
            //console.log(response); // dump complete info
            access_token = response.authResponse.accessToken; //get access token
            user_id = response.authResponse.userID; //get FB UID
            console.log('userid: ' + user_id);
            console.log('access_token: ' + access_token);

            change_UIview(1);


            FB.api('/me', function(response) {

                document.getElementById('fb_name').innerHTML = 'name: ' + response.name;
          // you can store this data into your database             
            });

        } else {
            //user hit cancel button
            console.log('User cancelled login or did not fully authorize.');

        }
    }, {
        scope: 'publish_actions,user_posts,user_photos,user_events,user_tagged_places'
    });
}


  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>





	<div id="preloader"></div>

	 <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">SAPapp</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="javascript:void(0)" id="logout_btn" onclick="fb_logout()" style="display:none;">Logout</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>


	<ul class="slideshow">
            <li><span>Image 01</span></li>
            <li><span>Image 02</span></li>
            <li><span>Image 03</span></li>
            <li><span>Image 04</span></li>
        </ul>
		<div class="container">

			
			<div class="content">
				
				
				<article class="col-md-12">
				
					<!-- START Login form -->
					
					<div class="row">

						<div class="col-md-3">
						</div>
					
						<!-- Login form -->
						<div class="col-md-6">
							<div class="panel panel-form">
								<!-- Form header -->
								<div class="panel-heading">
									<h2 class="title">Login using Facebook</h2>
									<p>in order to find who's your best friends!!</p>
								</div>
								
								<div class="panel-body">
								
									<form id="loginForm" role="form" method="POST">
										<!---
										<div class="form-group">
											<label for="username" class="control-label">Username</label>
											<div>
												<input type="text" name="username" class="form-control" id="username">
											</div>
										</div>
										

										<div class="form-group">
											<label for="password" class="control-label">Password</label>
											<div>
												<input type="password" name="password" class="form-control" id="password">
											</div>
										</div>
										--->

										<!-- Login button -->
										<div class="form-group center-btn">
											<button id="loginButton" type="button" class="btn btn-primary" onclick="fb_login()"><i class="fa fa-facebook-square fa-3"></i> Login using facebook</button>

											<button id="getFriends" style="display:none;" type="button" class="btn btn-primary" onclick="get_best_friends()">Show best friends!</button>

											<div id="fb_name"></div>
										</div>
									</form>
								</div>
							</div>
						</div>
						
						
						<div class="col-md-3">
						</div>
						
					</div>
					
					<!-- END Login form -->
					
				</article>
				
				<div class="clearfix"></div>
			</div>
		</div>
		

		<!-- jQuery -->
		<script src="js/jquery-2.1.1.min.js"></script>
		
		<!-- Bootstrap JS -->
		<script src="js/bootstrap.min.js"></script>
		
		<script>
		

		
		$(document).ready(function() {


		    $(window).load(function () {
		        setTimeout(function(){
		        	check_login_status();
		        	//fadeOut preloader
		            $('#preloader').fadeOut('slow', function () {  
		            });
		        },2000);

		    }); 
			
		
			
			
		});
		
		
		</script>


</body></html>